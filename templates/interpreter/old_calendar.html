{% extends 'intbase.html' %}

{% block title %}Schedule -  DBD I&T{% endblock %}

{% block content %}
    <!-- Calendar Navigation -->
    <div class="calendar-header card">
        <div class="card-content d-flex justify-content-between align-items-center">
            <button class="btn btn-icon" id="prevMonth">
                <i class="fas fa-chevron-left"></i>
            </button>
            <h2 class="current-month">February 2025</h2>
            <button class="btn btn-icon" id="nextMonth">
                <i class="fas fa-chevron-right"></i>
            </button>
        </div>
    </div>

    <!-- Calendar Grid -->
    <div class="calendar-container card mt-4">
        <div class="weekdays-grid">
            <div>Mon</div>
            <div>Tue</div>
            <div>Wed</div>
            <div>Thu</div>
            <div>Fri</div>
            <div>Sat</div>
            <div>Sun</div>
        </div>
        <div class="days-grid" id="calendarDays">
            <!-- Days will be generated by JavaScript -->
        </div>
    </div>

    <!-- Day's Missions -->
    <div class="card mt-4">
        <div class="card-header">
            <h3 class="selected-date">Missions for <span id="selectedDate">February 11, 2025</span></h3>
        </div>
        <div class="card-content" id="dayMissions">
            <!-- Mission Item -->
            <div class="mission-item">
                <div class="mission-time">2:00 PM - 3:00 PM</div>
                <div class="mission-info">
                    <div class="mission-client">
                        <i class="fas fa-user"></i>
                        <span>John Smith</span>
                    </div>
                    <div class="mission-location">
                        <i class="fas fa-map-marker-alt"></i>
                        <span>Central Hospital</span>
                    </div>
                    <div class="mission-language">
                        <i class="fas fa-language"></i>
                        <span>English - Spanish</span>
                    </div>
                    <div class="mission-status accepted">
                        Accepted
                    </div>
                </div>
            </div>
        </div>
    </div>
{% endblock %}

{% block extra_css %}
<style>
    .calendar-header {
        background: rgba(255, 255, 255, 0.1);
    }

    .current-month {
        font-size: 1.25rem;
        font-weight: bold;
        color: var(--white);
    }

    .btn-icon {
        width: 40px;
        height: 40px;
        border-radius: 50%;
        background: rgba(255, 255, 255, 0.1);
        color: var(--white);
        display: flex;
        align-items: center;
        justify-content: center;
        transition: background 0.3s;
    }

    .btn-icon:hover {
        background: rgba(255, 255, 255, 0.2);
    }

    .weekdays-grid {
        display: grid;
        grid-template-columns: repeat(7, 1fr);
        background: rgba(0, 0, 0, 0.2);
        padding: 1rem;
        text-align: center;
        font-weight: 500;
    }

    .days-grid {
        display: grid;
        grid-template-columns: repeat(7, 1fr);
        gap: 1px;
        background: rgba(255, 255, 255, 0.1);
    }

    .calendar-day {
        aspect-ratio: 1;
        padding: 0.5rem;
        background: rgba(255, 255, 255, 0.05);
        position: relative;
        cursor: pointer;
        transition: background 0.3s;
    }

    .calendar-day:hover {
        background: rgba(255, 255, 255, 0.1);
    }

    .calendar-day.today {
        background: rgba(var(--primary-green-rgb), 0.2);
    }

    .calendar-day.selected {
        background: rgba(var(--primary-green-rgb), 0.3);
    }

    .calendar-day.has-missions::after {
        content: '';
        position: absolute;
        bottom: 0.5rem;
        left: 50%;
        transform: translateX(-50%);
        width: 6px;
        height: 6px;
        border-radius: 50%;
        background: var(--primary-green);
    }

    .day-number {
        font-size: 0.9rem;
    }

    .other-month {
        opacity: 0.5;
    }

    .selected-date {
        font-size: 1.1rem;
        font-weight: 500;
    }

    .mission-item {
        padding: 1rem;
        border-bottom: 1px solid rgba(255, 255, 255, 0.1);
    }

    .mission-item:last-child {
        border-bottom: none;
    }

    .mission-time {
        font-size: 1.1rem;
        font-weight: 500;
        color: var(--primary-green);
        margin-bottom: 0.5rem;
    }

    .mission-info {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
        gap: 1rem;
    }

    .mission-info > div {
        display: flex;
        align-items: center;
        gap: 0.5rem;
    }

    .mission-status {
        padding: 0.25rem 0.75rem;
        border-radius: 1rem;
        font-size: 0.8rem;
        font-weight: 500;
        width: fit-content;
    }

    .mission-status.pending {
        background: var(--warning);
    }

    .mission-status.accepted {
        background: var(--success);
    }

    .mission-status.completed {
        background: var(--gray-700);
    }

    @media (max-width: 768px) {
        .mission-info {
            grid-template-columns: 1fr;
        }
    }
</style>
{% endblock %}

{% block extra_scripts %}
<script>
    let currentDate = new Date();
    let selectedDate = new Date();

    function generateCalendar(year, month) {
        const firstDay = new Date(year, month, 1);
        const lastDay = new Date(year, month + 1, 0);
        const startingDay = firstDay.getDay() || 7; // Convert Sunday (0) to 7
        const totalDays = lastDay.getDate();
        
        const calendarDays = document.getElementById('calendarDays');
        calendarDays.innerHTML = '';

        // Previous month days
        const prevMonthDays = startingDay - 1;
        const prevMonth = new Date(year, month - 1, 0);
        for (let i = prevMonthDays; i > 0; i--) {
            const dayElement = createDayElement(prevMonth.getDate() - i + 1, true);
            calendarDays.appendChild(dayElement);
        }

        // Current month days
        for (let day = 1; day <= totalDays; day++) {
            const dayElement = createDayElement(day, false);
            if (year === currentDate.getFullYear() && 
                month === currentDate.getMonth() && 
                day === currentDate.getDate()) {
                dayElement.classList.add('today');
            }
            if (year === selectedDate.getFullYear() && 
                month === selectedDate.getMonth() && 
                day === selectedDate.getDate()) {
                dayElement.classList.add('selected');
            }
            // Example: Add indicator for days with missions
            if (day % 3 === 0) {
                dayElement.classList.add('has-missions');
            }
            calendarDays.appendChild(dayElement);
        }

        // Next month days
        const remainingDays = 42 - (prevMonthDays + totalDays); // 42 = 6 rows Ã— 7 days
        for (let day = 1; day <= remainingDays; day++) {
            const dayElement = createDayElement(day, true);
            calendarDays.appendChild(dayElement);
        }

        // Update month display
        document.querySelector('.current-month').textContent = 
            new Date(year, month).toLocaleDateString('en-US', { month: 'long', year: 'numeric' });
    }

    function createDayElement(day, isOtherMonth) {
        const dayElement = document.createElement('div');
        dayElement.className = `calendar-day${isOtherMonth ? ' other-month' : ''}`;
        dayElement.innerHTML = `<span class="day-number">${day}</span>`;
        
        dayElement.addEventListener('click', () => selectDate(day, isOtherMonth));
        return dayElement;
    }

    function selectDate(day, isOtherMonth) {
        document.querySelector('.calendar-day.selected')?.classList.remove('selected');
        event.currentTarget.classList.add('selected');

        if (isOtherMonth) {
            if (day > 20) { // Previous month
                currentDate.setMonth(currentDate.getMonth() - 1);
            } else { // Next month
                currentDate.setMonth(currentDate.getMonth() + 1);
            }
            generateCalendar(currentDate.getFullYear(), currentDate.getMonth());
        }

        selectedDate = new Date(currentDate.getFullYear(), currentDate.getMonth(), day);
        document.getElementById('selectedDate').textContent = 
            selectedDate.toLocaleDateString('en-US', { month: 'long', day: 'numeric', year: 'numeric' });
        
        // Here you would typically fetch and display missions for the selected date
        updateMissions(selectedDate);
    }

    function updateMissions(date) {
        // Add your logic to fetch and display missions for the selected date
        console.log('Fetching missions for:', date);
    }

    // Initialize calendar
    generateCalendar(currentDate.getFullYear(), currentDate.getMonth());

    // Event listeners for month navigation
    document.getElementById('prevMonth').addEventListener('click', () => {
        currentDate.setMonth(currentDate.getMonth() - 1);
        generateCalendar(currentDate.getFullYear(), currentDate.getMonth());
    });

    document.getElementById('nextMonth').addEventListener('click', () => {
        currentDate.setMonth(currentDate.getMonth() + 1);
        generateCalendar(currentDate.getFullYear(), currentDate.getMonth());
    });
</script>
{% endblock %}